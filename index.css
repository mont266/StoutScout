@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html,
  body,
  #root {
    @apply h-full w-full;
    /* This ensures a consistent height chain for the app to fill the viewport */
    position: fixed; /* Lock the viewport to prevent scrolling on the body */
    overflow: hidden; /* Prevent the root elements themselves from scrolling */
    overscroll-behavior: contain; /* Prevent "bounce" or "pull-to-refresh" */
  }

  body {
    @apply bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-white font-sans antialiased;
    /* Add padding for device notches and system UI (status bar, home indicator) */
    padding-top: env(safe-area-inset-top);
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }
}

@layer components {
  /* This class is used in MobileLayout.jsx to add padding for the home indicator */
  .pb-safe {
    padding-bottom: env(safe-area-inset-bottom);
  }

  /*
    Adds padding to the bottom of the tab bar on native Android devices
    to prevent it from being obscured by the system navigation controls.
    This replaces the previous `::after` pseudo-element approach.
  */
  .native-android .main-tab-bar {
    padding-bottom: 1.5rem;
  }
  
  /*
    Adds extra padding to the bottom of the tab bar on native iOS devices
    to prevent it from overlapping with the home indicator area.
  */
  .native-ios .main-tab-bar {
    padding-bottom: 1rem;
  }
  
  /* New class to adjust scroll-to-top button on native Android */
  .native-android .scroll-to-top-android-fix {
    /* bottom-24 is 6rem. Add 1.5rem for the android nav bar padding. 7.5rem is bottom-30. */
    bottom: 7.5rem;
  }


  #orientation-lock-overlay {
    @apply fixed inset-0 z-[100] bg-gray-900 text-white flex-col items-center justify-center text-center p-8 hidden; /* hidden by default */
  }

  /* New styles for the improved overlay */
  .phone-graphic {
    @apply relative w-24 h-48;
    animation: rotate-hint 3s ease-in-out infinite;
  }
  
  .phone-outline, .stoutly-logo {
    @apply absolute top-0 left-0 w-full h-full;
  }

  .stoutly-logo {
    @apply p-6; /* Add padding to fit the logo nicely inside the phone */
  }

  @keyframes rotate-hint {
    0% { transform: rotate(90deg); }
    30% { transform: rotate(0deg); }
    70% { transform: rotate(0deg); }
    100% { transform: rotate(90deg); }
  }

  .community-header {
    transition: transform 0.3s ease-in-out;
  }
  .community-header.hide-header {
      transform: translateY(-100%);
  }
  
  .feed-header {
    /* This is now sticky inside CommunityFeed.jsx */
  }
  
  .create-post-container {
    transition: max-height 0.3s ease-in-out, padding 0.3s ease-in-out, opacity 0.3s ease-in-out;
    max-height: 10rem; /* A safe large value to not clip content */
    overflow: hidden;
    opacity: 1;
  }
  .create-post-container.hide {
    max-height: 0;
    padding-top: 0;
    padding-bottom: 0;
    opacity: 0;
  }
  
  /* New styles for collapsible community feed header */
  .community-feed-header {
    @apply sticky top-0 z-20 bg-gray-100/80 dark:bg-gray-900/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 relative;
  }
  
  .community-filters-content {
    @apply transition-all duration-300 ease-in-out; /* Removed overflow-hidden */
    max-height: 20rem; /* Open state */
  }
  
  .community-filters-content.collapsed {
    max-height: 0;
    @apply overflow-hidden; /* Apply overflow-hidden only when collapsed */
  }
  
  .community-filters-toggle-tab {
    @apply absolute left-1/2 z-0;
    bottom: 0;
    transform: translate(-50%, 100%);
    transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
    opacity: 0;
    pointer-events: none;
  }
  
  .community-filters-toggle-tab.visible {
    opacity: 1;
    pointer-events: auto;
  }


  /* Styles for accordion transitions */
  .accordion-content {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows 0.3s ease-out, opacity 0.2s ease-out;
    opacity: 0.5;
  }
  .accordion-content.expanded {
    grid-template-rows: 1fr;
    opacity: 1;
  }
  .accordion-content > div {
    overflow: hidden;
  }

  /* St. Paddy's Day Theme Overrides */
  .st-paddys-mode {
    --st-paddys-green-500: #22c55e;
    --st-paddys-green-400: #4ade80;
    --st-paddys-green-600: #16a34a;
    --st-paddys-dark-bg: hsl(140, 80%, 8%);
  }

  .st-paddys-mode body {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32' width='32' height='32' fill='none' stroke='rgb(255 255 255 / 0.05)'%3e%3cpath d='M16,27 L16,15 M16,15 C20,15 23,12 23,8 C23,4 20,1 16,1 C12,1 9,4 9,8 C9,12 12,15 16,15 M16,15 C12,19 8,20 6,17 C4,14 6,11 9,10 C12,9 15,11 16,15 M16,15 C20,19 24,20 26,17 C28,14 26,11 23,10 C20,9 17,11 16,15 Z' stroke-width='2'/%3e%3c/svg%3e");
    background-color: hsl(140, 80%, 4%);
  }

  .st-paddys-mode.dark body {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32' width='32' height='32' fill='none' stroke='rgb(255 255 255 / 0.05)'%3e%3cpath d='M16,27 L16,15 M16,15 C20,15 23,12 23,8 C23,4 20,1 16,1 C12,1 9,4 9,8 C9,12 12,15 16,15 M16,15 C12,19 8,20 6,17 C4,14 6,11 9,10 C12,9 15,11 16,15 M16,15 C20,19 24,20 26,17 C28,14 26,11 23,10 C20,9 17,11 16,15 Z' stroke-width='2'/%3e%3c/svg%3e");
  }

  .st-paddys-mode .dark\:bg-gray-900 { @apply dark:bg-[var(--st-paddys-dark-bg)]; }
  .st-paddys-mode .dark\:bg-gray-800 { @apply dark:bg-green-950/50; }
  .st-paddys-mode .stoutly-logo-stroke { stroke: var(--st-paddys-green-500); }

  .st-paddys-mode .text-amber-500 { color: var(--st-paddys-green-500); }
  .st-paddys-mode .dark .text-amber-400 { color: var(--st-paddys-green-400); }
  .st-paddys-mode .bg-amber-500 { background-color: var(--st-paddys-green-500); }
  .st-paddys-mode .border-amber-500 { border-color: var(--st-paddys-green-500); }
  .st-paddys-mode .accent-amber-500 { accent-color: var(--st-paddys-green-500); }
  .st-paddys-mode .hover\:text-amber-600:hover { color: var(--st-paddys-green-600); }
  .st-paddys-mode .dark .hover\:text-amber-400:hover { color: var(--st-paddys-green-400); }
  .st-paddys-mode .focus\:ring-amber-500:focus { --tw-ring-color: var(--st-paddys-green-500); }
  .st-paddys-mode .text-amber-600 { color: var(--st-paddys-green-600); }
  .st-paddys-mode .dark .text-amber-300 { color: #86efac; /* green-300 */ }
  .st-paddys-mode .from-amber-100 { --tw-gradient-from: #dcfce7; --tw-gradient-to: rgba(220, 252, 231, 0); }
  .st-paddys-mode .dark\:to-amber-900 { --tw-gradient-to: #14532d; }
  .st-paddys-mode .bg-amber-500\/10 { background-color: rgba(34, 197, 94, 0.1); }
  .st-paddys-mode .text-amber-700 { color: #15803d; }
  .st-paddys-mode .dark\:text-amber-300 { color: #86efac; }
  .st-paddys-mode .border-amber-400 { border-color: var(--st-paddys-green-400); }

  /* Apply St Paddy's filter to map tiles if active */
  .st-paddys-mode .mapboxgl-canvas {
    filter: sepia(0.5) hue-rotate(80deg) saturate(1.2) contrast(0.9);
  }

  /* Custom styles for Mapbox Navigation Control */
  .mapboxgl-ctrl-group {
    @apply bg-white shadow-md rounded-md border border-gray-200;
  }
  .mapboxgl-ctrl-group button {
    @apply bg-white text-gray-700 transition-colors;
  }
  .mapboxgl-ctrl-group button:hover {
    @apply bg-gray-100;
  }
  .mapboxgl-ctrl-group button + button {
    @apply border-t border-gray-200;
  }

  /* Dark mode overrides for Mapbox Navigation Control */
  .dark .mapboxgl-ctrl-group {
    @apply bg-gray-800 border-gray-700;
  }
  .dark .mapboxgl-ctrl-group button {
    @apply bg-gray-800 text-gray-300;
  }
  .dark .mapboxgl-ctrl-group button:hover {
    @apply bg-gray-700;
  }
  .dark .mapboxgl-ctrl-group button + button {
    @apply border-t border-gray-700;
  }
  .dark .mapboxgl-ctrl-group button .mapboxgl-ctrl-icon {
    /* This filter converts the default dark gray icon (#333) to Stoutly amber (#F59E0B) */
    filter: invert(29%) sepia(96%) saturate(2471%) hue-rotate(24deg) brightness(101%) contrast(94%);
  }
  .dark .mapboxgl-ctrl-compass-arrow {
    /* This filter now correctly converts the default dark gray arrow (#333) to Stoutly amber (#F59E0B) for consistency. */
    filter: invert(29%) sepia(96%) saturate(2471%) hue-rotate(24deg) brightness(101%) contrast(94%);
  }

  /* Styles for map loading overlay */
  .map-loading-overlay {
    @apply absolute inset-0 z-[1000] flex items-center justify-center bg-gray-900/50 backdrop-blur-sm transition-opacity duration-300;
    animation: fadeIn 0.3s ease-out;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
}

/* Show overlay and hide app only on mobile devices in landscape.
   We use max-height as a proxy for a phone, as a phone's height in landscape
   is much smaller than its width, and smaller than a tablet's height. */
@media (orientation: landscape) and (max-height: 600px) {
  #root, #modal-root {
    display: none; /* Hide the app content */
  }
  #orientation-lock-overlay {
    display: flex; /* Show the overlay */
  }
}

/* Apply dark mode filter to map tiles, but NOT if St Paddy's mode is also active */
.dark:not(.st-paddys-mode) .mapboxgl-canvas {
  filter: brightness(1.4) contrast(0.9) saturate(0.9);
}

@keyframes highlight {
  0% { background-color: rgba(251, 191, 36, 0); } /* amber-400 */
  50% { background-color: rgba(251, 191, 36, 0.3); }
  100% { background-color: rgba(251, 191, 36, 0); }
}

.highlight-rating {
  animation: highlight 2.5s ease-in-out;
}

.highlight-comment {
  animation: highlight 2.5s ease-in-out;
}

@keyframes shrink-width {
  from { width: 100%; }
  to { width: 0%; }
}

.progress-bar-animate {
  animation: shrink-width linear forwards;
}

.animate-pulse-blue-dot {
  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes pulse {
  50% {
    opacity: .5;
  }
}

@media (max-width: 767px) {
  .mapboxgl-ctrl-top-left .mapboxgl-ctrl {
    margin-top: 4.0rem; /* Push controls down below filter bar on mobile */
  }
}

/* Specific fix for Mapbox controls on native Android to ensure they are below the filter bar */
.native-android .mapboxgl-ctrl-top-left .mapboxgl-ctrl {
  margin-top: 4.0rem;
}

/* Specific fix for Mapbox controls on native iOS to ensure they sit below the header and filter bar */
.native-ios .mapboxgl-ctrl-top-left .mapboxgl-ctrl {
  margin-top: 4.0rem;
}